#!/usr/bin/env ruby

require "coingecko_ruby"
require "pastel"

client = CoingeckoRuby::Client.new
pastel = Pastel.new

if ARGV.length > 0
  requested_crypto, requested_currency = ARGV.first(2).map { |argument| argument.to_s.chomp.downcase }
end

if requested_crypto.nil?
  puts "Please enter a name such as \"bitcoin\""
  return
end

requested_currency ||= "usd"

historical_prices = client.daily_historical_price(requested_crypto, currency: requested_currency, days: 1)
yesterdays_price = historical_prices["prices"].first.last

current_price = client.hourly_historical_price(requested_crypto, currency: requested_currency, days: 1)
current_price = current_price["prices"].last.last

colour = if current_price > yesterdays_price
  :green
elsif yesterdays_price > current_price
  :red
else # They are equal
  :white
end

puts pastel.send(colour, current_price)
